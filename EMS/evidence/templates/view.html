<html lang="en">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Evidence Search</title>
  <link rel="stylesheet" href="{% static 'evidence/css/View.css' %}">
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
  {% include 'nav.html' %}


  <!-- Search Container -->
  <div style="margin-top:100px;" class="search-container">
    <input type="text" id="search-bar" placeholder="Enter Hash ID to find related case evidence" />
    <button class="search-btn" id="search-btn">Search</button>
  </div>
  </header>

  <!-- Evidence Cards Container -->
  <div class="evidence-container" id="evidenceContainer">
    <!-- Example Card 1 -->
    <div class="evidence-card">
      <div class="card-content">
        <h2>Ram Parsad</h2>
        <p><strong>Crime Name:</strong> Financial Fraud</p>
        <p><strong>Nationality:</strong> Nepali</p>
        <p><strong>National ID Card Number:</strong> 0000000000</p>
        <p><strong>Description:</strong> Ram Parsad was involved in a financial fraud scheme causing significant losses to multiple companies.</p>
        <p><strong>Date and Time of Evidence:</strong> 2024-12-18 14:30</p>
      </div>
    </div>
  </div>
  {% include 'footer.html' %}

  <script>

    // Import Web3.js
const Web3 = require('web3');

// Initialize Web3 (using MetaMask's provider, or you can use Infura or other providers)
const web3 = new Web3(window.ethereum); // In the browser (MetaMask) or Infura for Node.js

// Your contract's ABI and address (replace with actual values)
const contractABI = [
  // ABI from the compiled contract
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": false,
        "internalType": "string",
        "name": "hashID",
        "type": "string"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "userAddress",
        "type": "address"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "timeStamp",
        "type": "uint256"
      }
    ],
    "name": "HashStored",
    "type": "event"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "hashID",
        "type": "string"
      },
      {
        "internalType": "address",
        "name": "userAddress",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "timeStamp",
        "type": "uint256"
      }
    ],
    "name": "storeHash",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "hashID",
        "type": "string"
      }
    ],
    "name": "getHashDetails",
    "outputs": [
      {
        "internalType": "string",
        "name": "",
        "type": "string"
      },
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "",
        "type": "string"
      }
    ],
    "name": "hashRecords",
    "outputs": [
      {
        "internalType": "string",
        "name": "hashID",
        "type": "string"
      },
      {
        "internalType": "address",
        "name": "userAddress",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "timeStamp",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  }
  // Include other ABI elements if necessary
];

const contractAddress = '0xb7d08f5195e27a44253931389acb0f97b4457748';  // Replace with your deployed contract address

// Create contract instance
const contract = new web3.eth.Contract(contractABI, contractAddress);

// Function to retrieve IPFS hash
async function getIPFSHash(hashID) {
    try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });

        // Call the getHashDetails method from the smart contract
        const result = await contract.methods.getHashDetails(hashID).call({ from: accounts[0] });

        // The first item in result is the IPFS hash
        const ipfsHash = result[0];
        console.log("IPFS Hash: ", ipfsHash);

        return ipfsHash;
    } catch (error) {
        console.error("Error retrieving IPFS hash:", error);
    }
}

/ Handle the search button click
document.getElementById('search-btn').addEventListener('click', async () => {
    const hashID = document.getElementById('search-bar').value;
    
    if (!hashID) {
        alert("Please enter a Hash ID");
        return;
    }

    // Get evidence data from the contract and IPFS
    const evidence = await getIPFSHash(hashID);

    console.log(evidence);
});


  
  
  </script>

  
</body>
</html>
